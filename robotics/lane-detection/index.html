<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"> <!-- begin SEO --><title>Finding Lane Lines on the Road - Giovanni Claudio - Personal Website</title><meta property="og:locale" content="en-US"><meta property="og:site_name" content="Giovanni Claudio - Personal Website"><meta property="og:title" content="Finding Lane Lines on the Road"><link rel="canonical" href="index.html"><meta property="og:url" content="http://jokla.me/robotics/lane-detection/"><meta property="og:description" content="First project of the Udacity Self Driving Car NanoDegree"><meta property="og:type" content="article"><meta property="article:published_time" content="2017-03-10T00:00:00+00:00"> <script type="application/ld+json"> { "@context" : "http://schema.org", "@type" : "Person", "name" : "Giovanni Claudio", "url" : "http://jokla.me", "sameAs" : null } </script> <!-- end SEO --><link href="../../feed.xml" type="application/atom+xml" rel="alternate" title="Giovanni Claudio - Personal Website Feed"> <!-- http://t.co/dKP3o1e --><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width, initial-scale=1.0"> <script> document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js '; </script> <!-- For all browsers --><link rel="stylesheet" href="../../assets/css/main.css"><meta http-equiv="cleartype" content="on"> <!-- start custom head snippets --> <!-- insert favicons. use http://realfavicongenerator.net/ --> <!-- end custom head snippets --></head><body> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav id="site-nav" class="greedy-nav"> <button><div class="navicon"></div></button><ul class="visible-links"><li class="masthead__menu-item masthead__menu-item--lg"><a href="../../index.html">Giovanni Claudio - Personal Website</a></li><li class="masthead__menu-item"><a href="../../about/index.html">About me</a></li><li class="masthead__menu-item"><a href="../../posts/index.html">Posts</a></li><li class="masthead__menu-item"><a href="../../work/index.html">Work</a></li><li class="masthead__menu-item"><a href="../../software/index.html">Software</a></li><li class="masthead__menu-item"><a href="../../music/index.html">Music</a></li></ul><ul class="hidden-links hidden"></ul></nav></div></div></div><div id="main" role="main"><div class="sidebar sticky"><div itemscope itemtype="http://schema.org/Person"><div class="author__avatar"> <img src="../../images/bio-photo.jpg" class="author__avatar" alt="Giovanni Claudio"></div><div class="author__content"><h3 class="author__name">Giovanni Claudio</h3><p class="author__bio">Autonomous Driving Engineer</p></div><div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button><ul class="author__urls social-icons"><li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> Turin</li><li><a href="https://www.linkedin.com/in/giovanniclaudio"><i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn</a></li><li><a href="https://github.com/jokla"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li><li><a href="https://www.youtube.com/user/Jokla89zena"><i class="fa fa-fw fa-youtube-square" aria-hidden="true"></i> YouTube</a></li></ul></div></div></div><article class="page" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="headline" content="Finding Lane Lines on the Road"><meta itemprop="description" content="First project of the Udacity Self Driving Car NanoDegree"><meta itemprop="datePublished" content="March 10, 2017"><meta itemprop="dateModified" content="March 10, 2017"><div class="page__inner-wrap"><header><h1 class="page__title" itemprop="headline">Finding Lane Lines on the Road</h1></header><section class="page__content" itemprop="text"><h1 id="overview">Overview:</h1><p>The goal of this project is to make a pipeline that finds lane lines on the road using Python and OpenCV. See an example:</p><p><img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/solidWhiteRight.jpg" width="360" alt="Combined Image" /> <img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/laneLines_thirdPass.jpg" width="360" alt="Combined Image" /></p><p>The pipeline will be tested on some images and videos provided by Udacity. The following assumptions are made:</p><ul><li>The camera always has the same position with respect to the road</li><li>There is always a visible white or yellow line on the road</li><li>We don’t have any vehicle in front of us</li><li>We consider highway scenario with good weather conditions</li></ul><p><a href="https://github.com/jokla/CarND-LaneLines-P1">Here</a> you can find the project.</p><hr /><h1 id="reflection">Reflection</h1><h2 id="1-pipeline-description">1. Pipeline description</h2><p>I will use the following picture to show you all the steps:</p><p><img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/original.png" width="360" alt="Combined Image" /></p><h3 id="color-selection">Color selection</h3><p>Firstly, I applied a color filtering to suppress non-yellow and non-white colors. The pixels that were above the thresholds have been retained, and pixels below the threshold have been blacked out. This is the result:</p><p><img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/mask_color.png" width="360" alt="Combined Image" /></p><p>I will keep aside this mask and use it later.</p><h3 id="convert-the-color-image-in-grayscale">Convert the color image in grayscale</h3><p>The original image is converted in grayscale. In this way we have only one channel:</p><p><img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/gray.png" width="360" alt="Combined Image" /></p><h4 id="use-canny-for-edge-detection">Use Canny for edge detection</h4><p>Before running the <a href="http://docs.opencv.org/2.4/doc/tutorials/imgproc/imgtrans/canny_detector/canny_detector.html">Canny detector</a>, I applied a <a href="http://docs.opencv.org/2.4/modules/imgproc/doc/filtering.html?highlight=gaussianblur#gaussianblur">Gaussian smoothing</a> which is essentially a way of suppressing noise and spurious gradients by averaging. The Canny allows detecting the edges in the images. To improve the result, I also used the OpenCV function <code class="highlighter-rouge">dilate</code> and <code class="highlighter-rouge">erode</code>.</p><p><img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/canny.png" width="360" alt="Combined Image" /></p><h3 id="merge-canny-and-color-selection">Merge Canny and Color Selection</h3><p>In some cases, the Canny edge detector fails to find the lines. For example, when there is not enough contrast between the asphalt and the line, as in the challenge video (see section <code class="highlighter-rouge">Optional challenge</code>). The color selection, on the other hand, doesn’t have this problem. For this reason, I decided to merge the result of the Canny detector and the color selection:</p><p><img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/merge.png" width="360" alt="Combined Image" /></p><h3 id="region-of-interest-mask">Region Of Interest Mask</h3><p>I defined a left and right trapezoidal Region Of Interest (ROI) based on the image size. Since that the front facing camera is mounted in a fix position, we supposed here that the lane lines will always appear in the same region of the image.</p><p><img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/roi.png" width="360" alt="Combined Image" /></p><h3 id="run-hough-transform-to-detect-lines">Run Hough transform to detect lines</h3><p>The Hough transform is used to detect lines in the images. At this step, I applied a slope filter to get rid of horizontal lines. This is the result: <br /> <img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/hough.png" width="360" alt="Combined Image" /></p><h3 id="compute-lines">Compute lines</h3><p>Now I need to average/extrapolate the result of the Hough transform and draw the two lines onto the image. I used the function <a href="http://docs.opencv.org/2.4/modules/imgproc/doc/structural_analysis_and_shape_descriptors.html#fitline"><code class="highlighter-rouge">fitLine</code></a>, after having extrapolated the points from the Hough tranform result with the OpenCV function <code class="highlighter-rouge">findNonZero</code>. I did this two times, once for the right line and another time for the left line. As a result, I got the slopes of the lines, and I could draw them onto the original picture:</p><p><img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/final.png" width="360" alt="Combined Image" /></p><h1 id="results">Results:</h1><h2 id="pictures">Pictures</h2><p>Here some results on test images provided by Udacity: <br /> <img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/final.png" width="360" alt="Combined Image" /> <img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/result1.png" width="360" alt="Combined Image" /> <br /> <img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/result2.png" width="360" alt="Combined Image" /> <img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/result3.png" width="360" alt="Combined Image" /> <br /> <img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/result4.png" width="360" alt="Combined Image" /> <img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/result5.png" width="360" alt="Combined Image" /></p><p>You can find the original pictures and the results in the folder <code class="highlighter-rouge">test_images</code>.</p><h2 id="videos">Videos</h2><p>Here some results on test videos provided by Udacity:</p><p><img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/white.gif" alt="" /> <img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/yellow.gif" alt="" /></p><p>You can find the video files here: <a href="https://github.com/jokla/CarND-LaneLines-P1/blob/master/yellow.mp4">video1</a>, <a href="https://github.com/jokla/CarND-LaneLines-P1/blob/master/white.mp4">video2</a>.</p><h3 id="optional-challenge">Optional challenge:</h3><p>While I got a satisfactory result on the first two videos provided by Udacity, it was not the case for the challenge video. In the challenge video we can identify more difficulties:</p><ul><li>The color of the asphalt became lighter at a certain point. The Canny edge detector is not able to find the line using the grayscale image (where we lose information about the color)</li><li>The car is driving on a curving road</li><li>There are some shadows due to some trees</li></ul><p>To overcome theses problems, I introduced the color mask and resized the ROI. This is the result, using only the color mask (without the canny detection):</p><p><img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/extra.gif" alt="" /></p><p>You can find the video file here: <a href="https://github.com/jokla/CarND-LaneLines-P1/blob/master/extra.mp4">video_challenge</a></p><p>The right line is a little jumpy mainly because of the curve: the function <code class="highlighter-rouge">fitline</code> is trying to fit a line on a curvy lane. It would be useful to shrink the ROI in this case, but I preferred to keep the same ROI size used in the first two videos.</p><p>If we analyze the steps using a snapshot from the challenge video, we can notice that the Canny detector is not very useful:</p><p><img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/original_challenge.png" width="360" alt="Combined Image" /> <img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/canny_challenge.png" width="360" alt="Combined Image" /></p><p>while the color mask is able to detect the lines:</p><p><img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/color_challenge.png" width="360" alt="Combined Image" /></p><p>Indeed, as you can see in the following picture, we lose valuable color information when we convert the image in grayscale. Moreover, the Canny operator find a lot of edges when we have shadows on the road.</p><p><img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/gray_challenge.png" width="360" alt="Combined Image" /></p><h3 id="testing-the-pipeline-on-a-youtube-video">Testing the pipeline on a YouTube Video:</h3><p>Just out of curiosity, I wanted to test the pipeline on a video extracted from Youtube (see the original video <a href="https://www.youtube.com/watch?v=jwBaGY67olI">here</a> ).</p><p>I noticed that the color selection was not working properly in this case, so I had to tune a little bit the thresholds values. This is the new result using both color selection and Canny:</p><p><img src="https://raw.githubusercontent.com/jokla/jokla.github.io/master/images/post/2017-03-10-lane-detection/extra_test.gif" alt="" /></p><p>You can find the video file here: <a href="https://github.com/jokla/CarND-LaneLines-P1/blob/master/extra_test_result.mp4">video_extra</a></p><p>It would be wiser to transform the image in the HSV space and to apply the color selection, instead of doing it on the RGB images.</p><h2 id="2-potential-shortcomings-with-the-current-pipeline">2. Potential shortcomings with the current pipeline</h2><ul><li>This approach could not work properly:<ul><li>if the camera is placed at a different position</li><li>if other vehicles in front are occluding the view</li><li>if one or more lines are missing</li><li>at different weather and light condition (fog, rain, or at night)</li></ul></li></ul><h2 id="3-possible-improvements">3. Possible improvements</h2><p>Some possible improvements:</p><ul><li>Perform a color selection in the HSV space, instead of doing it in the RGB images</li><li>Update the ROI mask dynamically</li><li>Perform a segmentation of the road</li><li>Using a better filter to smooth the current estimation, using the previous ones</li><li>If a line is not detected, we could estimate the current slope using the previous estimations and/or the other line detection</li><li>Use a moving-edges tracker for the continuous lines</li></ul></section><footer class="page__meta"><p class="page__taxonomy"> <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong> <span itemprop="keywords"> <a href="../../tags/index.html#computer-vision" class="page__taxonomy-item" rel="tag">Computer vision</a><span class="sep">, </span> <a href="../../tags/index.html#opencv" class="page__taxonomy-item" rel="tag">OpenCV</a> </span></p><p class="page__taxonomy"> <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong> <span itemprop="keywords"> <a href="../../categories/index.html#robotics" class="page__taxonomy-item" rel="tag">Robotics</a> </span></p><p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-03-10">March 10, 2017</time></p></footer><section class="page__share"><h4 class="page__share-title">Share on</h4><a href="https://twitter.com/intent/tweet?text=http://jokla.me/robotics/lane-detection/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://jokla.me/robotics/lane-detection/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=http://jokla.me/robotics/lane-detection/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://jokla.me/robotics/lane-detection/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a></section><nav class="pagination"> <a href="../../self-driving-car/install-unity3d-ubuntu/index.html" class="pagination--pager" title="Install Unity3D in Ubuntu ">Previous</a> <a href="../traffic-signs/index.html" class="pagination--pager" title="Traffic Sign Recognition with Tensorflow ">Next</a></nav></div><div class="page__comments"><h4 class="page__comments-title">Leave a Comment</h4><section id="disqus_thread"></section></div></article><div class="page__related"><h4 class="page__related-title">You May Also Enjoy</h4><div class="grid__wrapper"><div class="grid__item"><article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork"><h2 class="archive__item-title" itemprop="headline"> <a href="../traffic-signs/index.html" rel="permalink">Traffic Sign Recognition with Tensorflow </a></h2><p class="archive__item-excerpt" itemprop="description">Designed a CNN inspired by LeNet architecture</p></article></div><div class="grid__item"><article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork"><h2 class="archive__item-title" itemprop="headline"> <a href="../../self-driving-car/install-unity3d-ubuntu/index.html" rel="permalink">Install Unity3D in Ubuntu </a></h2><p class="archive__item-excerpt" itemprop="description">Tested in Ubuntu 14.04</p></article></div><div class="grid__item"><article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork"><h2 class="archive__item-title" itemprop="headline"> <a href="../lookup-transform-ros/index.html" rel="permalink">How to compute frame transformations with Tf (ROS) </a></h2><p class="archive__item-excerpt" itemprop="description">using the function lookupTransform</p></article></div><div class="grid__item"><article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork"><h2 class="archive__item-title" itemprop="headline"> <a href="../camera-calibration-visp/index.html" rel="permalink">Intrinsic camera calibration for Nao/Romeo/Pepper with Visp </a></h2><p class="archive__item-excerpt" itemprop="description">Intrinsic camera calibration for Nao/Romeo/Pepper with Visp.</p></article></div></div></div></div><div class="page__footer"><footer> <!-- start custom footer snippets --> <!-- end custom footer snippets --><div class="page__footer-follow"><ul class="social-icons"><li><strong>Follow:</strong></li><li><a href="http://github.com/jokla"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li><li><a href="../../feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li></ul></div><div class="page__footer-copyright">&copy; 2017 Giovanni Claudio. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div></footer></div><script src="../../assets/js/main.min.js"></script> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-57751247-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> <script type="text/javascript"> /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */ var disqus_shortname = 'joklasite'; /* * * DON'T EDIT BELOW THIS LINE * * */ (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); /* * * DON'T EDIT BELOW THIS LINE * * */ (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></body></html>
