<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"> <!-- begin SEO --><title>Visp_naoqi Guide - Giovanni Claudio - Personal Website</title><meta property="og:locale" content="en-US"><meta property="og:site_name" content="Giovanni Claudio - Personal Website"><meta property="og:title" content="Visp_naoqi Guide"><link rel="canonical" href="index.html"><meta property="og:url" content="http://jokla.me/robotics/visp_naoqi/"><meta property="og:description" content="How to use the bridge Visp_naoqi."><meta property="og:type" content="article"><meta property="article:published_time" content="2014-09-29T00:00:00+00:00"> <script type="application/ld+json"> { "@context" : "http://schema.org", "@type" : "Person", "name" : "Giovanni Claudio", "url" : "http://jokla.me", "sameAs" : null } </script> <!-- end SEO --><link href="../../feed.xml" type="application/atom+xml" rel="alternate" title="Giovanni Claudio - Personal Website Feed"> <!-- http://t.co/dKP3o1e --><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width, initial-scale=1.0"> <script> document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js '; </script> <!-- For all browsers --><link rel="stylesheet" href="../../assets/css/main.css"><meta http-equiv="cleartype" content="on"> <!-- start custom head snippets --> <!-- insert favicons. use http://realfavicongenerator.net/ --> <!-- end custom head snippets --></head><body> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav id="site-nav" class="greedy-nav"> <button><div class="navicon"></div></button><ul class="visible-links"><li class="masthead__menu-item masthead__menu-item--lg"><a href="../../index.html">Giovanni Claudio - Personal Website</a></li><li class="masthead__menu-item"><a href="../../about/index.html">About me</a></li><li class="masthead__menu-item"><a href="../../posts/index.html">Posts</a></li><li class="masthead__menu-item"><a href="../../work/index.html">Work</a></li><li class="masthead__menu-item"><a href="../../software/index.html">Software</a></li><li class="masthead__menu-item"><a href="../../music/index.html">Music</a></li></ul><ul class="hidden-links hidden"></ul></nav></div></div></div><div id="main" role="main"><div class="sidebar sticky"><div itemscope itemtype="http://schema.org/Person"><div class="author__avatar"> <img src="../../images/bio-photo.jpg" class="author__avatar" alt="Giovanni Claudio"></div><div class="author__content"><h3 class="author__name">Giovanni Claudio</h3><p class="author__bio">Autonomous Driving Engineer</p></div><div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button><ul class="author__urls social-icons"><li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> Turin</li><li><a href="https://www.linkedin.com/in/giovanniclaudio"><i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn</a></li><li><a href="https://github.com/jokla"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li><li><a href="https://www.youtube.com/user/Jokla89zena"><i class="fa fa-fw fa-youtube-square" aria-hidden="true"></i> YouTube</a></li></ul></div></div></div><article class="page" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="headline" content="Visp_naoqi Guide"><meta itemprop="description" content="How to use the bridge Visp_naoqi."><meta itemprop="datePublished" content="September 29, 2014"><meta itemprop="dateModified" content="June 03, 2016"><div class="page__inner-wrap"><header><h1 class="page__title" itemprop="headline">Visp_naoqi Guide</h1></header><section class="page__content" itemprop="text"> <!--<aside class="sidebar__right"><nav class="toc" markdown="1"><header><h4 class="nav__title"><i class="fa fa-file-text"></i> table of contents</h4></header>* Auto generated table of contents {:toc .toc__menu}</nav></aside>--><p>Visp_naoqi is a C++ library, a bridge over ViSP and NaoQi. It is available on GitHub <a href="http://www.github.com/lagadic/visp_naoqi">http://www.github.com/lagadic/visp_naoqi</a>. You can find a description of the software <a href="../../software/visp_naoqi/index.html">here</a>.</p><h1 id="install-visp_naoqi-bridge">Install visp_naoqi bridge</h1><h2 id="prerequisites">Prerequisites</h2><ul><li>Install ViSP from source (See ViSP tutorials <a href="http://visp-doc.inria.fr/doxygen/visp-daily/tutorial-install-ubuntu.html">here</a>)</li><li>Install and configure Naoqi C++ SDK (You can follow <a href="../install-sdk-c-naoqi/index.html">this guide</a>)</li><li>Install Metapod library:<ul><li>Clone the repository of <a href="https://github.com/lagadic/metapod">Metapod library</a>: <br /> <code class="highlighter-rouge">git clone --recursive https://github.com/lagadic/metapod</code></li><li>Compile it (you will need liburdfdom or liburdf, see <a href="https://github.com/lagadic/metapod">here</a>):</li></ul></li></ul><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>mkdir _build
  <span class="nv">$ </span><span class="nb">cd </span>_build
  <span class="nv">$ </span>cmake <span class="nt">-DBUILD_METAPODFROMURDF</span><span class="o">=</span>ON ..
  <span class="nv">$ </span><span class="nb">sudo </span>make install
</code></pre></div></div><ul><li>If you are using <code class="highlighter-rouge">naoqi-sdk-2.3.0.14-linux64</code> (or newer) :<ul><li>Rename <code class="highlighter-rouge">naoqi-sdk-2.3.0.14-linux64/bin/metapodfromurdf</code> to <code class="highlighter-rouge">/naoqi-sdk-2.3.0.14-linux64/bin/metapodfromurdf_aldebaran</code></li><li>Open the file <code class="highlighter-rouge">/naoqi-sdk-2.3.0.14-linux64/include/qi/type/detail/object.hxx</code> and rename two times <code class="highlighter-rouge">None</code> to <code class="highlighter-rouge">None_</code> (lines 197,212)</li></ul></li></ul><h2 id="clone-and-build-visp_naoqi">Clone and build visp_naoqi</h2><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> ~/romeo/workspace
<span class="nv">$ </span>git clone http://www.github.com/lagadic/visp_naoqi.git
<span class="nv">$ </span>qibuild configure <span class="nt">-c</span> toolchain_romeo <span class="nt">-DVISP_DIR</span><span class="o">=</span>/local/soft/ViSP/ViSP-build-release
<span class="nv">$ </span>qibuild make <span class="nt">-c</span> toolchain_romeo
</code></pre></div></div><h2 id="known-issues">Known issues</h2><h3 id="1-system-libraries-conflict">1) System libraries conflict:</h3><p><code class="highlighter-rouge">$ qibuild configure -c toolchain_romeo -DVISP_DIR=/local/soft/ViSP/ViSP-build-release</code></p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CMake Warning at /udd/fspindle/.local/share/cmake/qibuild/target.cmake:85
<span class="o">(</span>add_executable<span class="o">)</span>:
Cannot generate a safe runtime search path <span class="k">for </span>target image_viewer_opencv
because files <span class="k">in </span>some directories may conflict with libraries <span class="k">in </span>implicit
directories:

runtime library <span class="o">[</span>libz.so.1] <span class="k">in</span> /usr/lib/x86_64-linux-gnu may be hidden by
files <span class="k">in</span>:
      /local/soft/romeo/devtools/naoqi-sdk-2.1.0.19-linux64/lib
</code></pre></div></div><p>In that case, backup <code class="highlighter-rouge">/local/soft/romeo/devtools/naoqi-sdk-2.1.0.19-linux64/lib</code> and remove the files<code class="highlighter-rouge">/naoqi-sdk-2.1.0.19-linux64/lib/libz.so.*</code></p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span><span class="nb">cd</span> /local/soft/romeo/devtools/naoqi-sdk-2.1.0.19-linux64/lib
  <span class="nv">$ </span>rm libz.so.<span class="k">*</span>
</code></pre></div></div><p>With the <code class="highlighter-rouge">naoqi-sdk-2.3.0.14-linux64</code> we have another conflict with <code class="highlighter-rouge">[libusb-1.0.so.0]</code>. Remove the files <code class="highlighter-rouge">libusb-1.*</code> in <code class="highlighter-rouge">/naoqi-sdk-2.3.0.14-linux64/lib</code>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span><span class="nb">cd</span> /local/soft/romeo/devtools/naoqi-sdk-2.3.0.14-linux64/lib
  <span class="nv">$ </span>rm libusb-1.<span class="k">*</span>
</code></pre></div></div><h3 id="2-macro-names-must-be-identifiers">2) Macro names must be identifiers:</h3><p><code class="highlighter-rouge">$ qibuild make -c toolchain_romeo</code></p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     ...
[ 20%] Building CXX object CMakeFiles/visp_naoqi.dir/src/grabber/vpNaoqiGrabber.cpp.o
&lt;command-line&gt;:0:1: error: macro names must be identifiers
&lt;command-line&gt;:0:1: error: macro names must be identifiers
&lt;command-line&gt;:0:1: error: macro names must be identifiers
</code></pre></div></div><p>Edit <code class="highlighter-rouge">/ViSP/ViSP-build-release/VISPConfig.cmake</code> to replace</p><p><code class="highlighter-rouge">SET(VISP_DEFINITIONS "-DVP_TRACE;-DVP_DEBUG;-DUNIX")</code></p><p>with:</p><p><code class="highlighter-rouge">SET(VISP_DEFINITIONS "VP_TRACE;VP_DEBUG;UNIX")</code></p><h3 id="3-conflicts-with-boost">3) Conflicts with boost:</h3><p><code class="highlighter-rouge">$ qibuild make -c toolchain_romeo</code></p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    Linking CXX executable sdk/bin/image_viewer_opencv
    /usr/bin/ld: warning: libboost_system.so.1.55.0, needed by   
    /local/soft/romeo/devtools/naoqi-sdk-2.1.0.19-linux64/lib/libqitype.so, 
    may conflict with libboost_system.so.1.54.0
</code></pre></div></div><p>In that case, you have to build again ViSP turning Ogre support off: <code class="highlighter-rouge">$ cd &lt;ViSP build folder&gt;</code> <code class="highlighter-rouge">$ cmake -DUSE_OGRE=OFF &lt;path to ViSP source code&gt;</code> <code class="highlighter-rouge">$ make -j8</code></p><h3 id="4--metapodalgosdjachh-no-such-file-or-directory">4) metapod/algos/djac.hh: No such file or directory</h3><ul><li>Open the file <code class="highlighter-rouge">CMakeLists.txt</code> of METAPOD and add the line: <br /> <code class="highlighter-rouge">include/${PROJECT_NAME}/algos/djac.hh</code> <br /> in <code class="highlighter-rouge">SET(${PROJECT_NAME}_ALGOS_HEADERS</code> after <code class="highlighter-rouge">include/${PROJECT_NAME}/algos/jac_point_chain.hh</code></li><li>Build and install Metapod again</li></ul><h3 id="5-rotationmatrix-is-not-a-member-of-metapodspatial">5) ‘RotationMatrix’ is not a member of ‘metapod::Spatial’</h3><p>If you have this error:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>error: ‘RotationMatrix’ is not a member of ‘metapod::Spatial’
error: wrong number of template arguments <span class="o">(</span>2, should be 3<span class="o">)</span>
error: template argument 3 is invalid
error: ‘Joint’ does not name a <span class="nb">type </span>Joint joint<span class="p">;</span>
</code></pre></div></div><ul><li>Rename <code class="highlighter-rouge">naoqi-sdk-2.3.0.14-linux64/bin/metapodfromurdf</code> to <code class="highlighter-rouge">/naoqi-sdk-2.3.0.14-linux64/bin/metapodfromurdf_aldebaran</code> In this way CMake will find the right version of <code class="highlighter-rouge">metapodfromurdf</code> (in /usr/local/bin/metapodfromurdf).</li></ul><h2 id="test-model-urdf-for-metapod">Test model URDF for Metapod</h2><p>In order to create a Metapod model it is necessary to symplify the original URDF model. To test it go to the folder <code class="highlighter-rouge">/metapod/_build/metapodfromurdf</code> (<code class="highlighter-rouge">_build</code> could have a different name, depending on what you choosed) and run:</p><p><code class="highlighter-rouge">metapodfromurdf pepper.urdf --name pepper --directory pepper</code></p><h2 id="sensor-log">Sensor LOG</h2><h3 id="record-position-and-velocity-romeo-joints">Record position and velocity Romeo Joints</h3><ul><li>Go via terminal in <code class="highlighter-rouge">/local/soft/romeo/python/from-aldebaran/module_sensor_log</code></li><li>Run the sensor log: <code class="highlighter-rouge">$ python sensorlog.py --ip 198.18.0.1 --port 9559</code></li><li>The sensor log will start to record all the position of the joints. To stop it press Ctrl+C.</li><li>A new txt file will be created in the directory (ex. <code class="highlighter-rouge">sensorlog.txt_romeo_1412082576.txt</code>)</li><li>Now we can plot the data using the script plotData.py: <code class="highlighter-rouge">$ python plotData.py --fileName sensorlog.txt_romeo_1412082576.txt --jointName RShoulderPitch --listPlot q dq</code></li><li>With <code class="highlighter-rouge">--listPlot</code> you can give one or more arguments among: <code class="highlighter-rouge">q", "dq", "torque", "plot2d", "plot3d"</code></li></ul><h2 id="velocity-controller-in-joint-space">Velocity controller in joint space:</h2><ul><li>You can find a python script in <code class="highlighter-rouge">/local/soft/romeo/python/Vel_Ctrl</code> named <code class="highlighter-rouge">motion_setVelocity.py</code>: <code class="highlighter-rouge">$ python motion_setVelocity.py --ip 198.18.0.1 --jointNameList NeckYaw --jointVelocityList +0.5</code></li></ul></section><footer class="page__meta"><p class="page__taxonomy"> <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong> <span itemprop="keywords"> <a href="../../tags/index.html#pepper" class="page__taxonomy-item" rel="tag">Pepper</a><span class="sep">, </span> <a href="../../tags/index.html#romeo" class="page__taxonomy-item" rel="tag">Romeo</a><span class="sep">, </span> <a href="../../tags/index.html#visp" class="page__taxonomy-item" rel="tag">ViSP</a> </span></p><p class="page__taxonomy"> <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong> <span itemprop="keywords"> <a href="../../categories/index.html#robotics" class="page__taxonomy-item" rel="tag">Robotics</a> </span></p><p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-06-03">June 03, 2016</time></p></footer><section class="page__share"><h4 class="page__share-title">Share on</h4><a href="https://twitter.com/intent/tweet?text=http://jokla.me/robotics/visp_naoqi/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://jokla.me/robotics/visp_naoqi/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=http://jokla.me/robotics/visp_naoqi/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://jokla.me/robotics/visp_naoqi/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a></section><nav class="pagination"> <a href="../install-simoro/index.html" class="pagination--pager" title="Install Symoro on Ubuntu 14.04 ">Previous</a> <a href="../../software/romeo_tk/index.html" class="pagination--pager" title="RomeoTk ">Next</a></nav></div><div class="page__comments"><h4 class="page__comments-title">Leave a Comment</h4><section id="disqus_thread"></section></div></article><div class="page__related"><h4 class="page__related-title">You May Also Enjoy</h4><div class="grid__wrapper"><div class="grid__item"><article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork"><h2 class="archive__item-title" itemprop="headline"> <a href="../traffic-signs/index.html" rel="permalink">Traffic Sign Recognition with Tensorflow </a></h2><p class="archive__item-excerpt" itemprop="description">Designed a CNN inspired by LeNet architecture</p></article></div><div class="grid__item"><article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork"><h2 class="archive__item-title" itemprop="headline"> <a href="../lane-detection/index.html" rel="permalink">Finding Lane Lines on the Road </a></h2><p class="archive__item-excerpt" itemprop="description">First project of the Udacity Self Driving Car NanoDegree</p></article></div><div class="grid__item"><article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork"><h2 class="archive__item-title" itemprop="headline"> <a href="../../self-driving-car/install-unity3d-ubuntu/index.html" rel="permalink">Install Unity3D in Ubuntu </a></h2><p class="archive__item-excerpt" itemprop="description">Tested in Ubuntu 14.04</p></article></div><div class="grid__item"><article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork"><h2 class="archive__item-title" itemprop="headline"> <a href="../lookup-transform-ros/index.html" rel="permalink">How to compute frame transformations with Tf (ROS) </a></h2><p class="archive__item-excerpt" itemprop="description">using the function lookupTransform</p></article></div></div></div></div><div class="page__footer"><footer> <!-- start custom footer snippets --> <!-- end custom footer snippets --><div class="page__footer-follow"><ul class="social-icons"><li><strong>Follow:</strong></li><li><a href="http://github.com/jokla"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li><li><a href="../../feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li></ul></div><div class="page__footer-copyright">&copy; 2017 Giovanni Claudio. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div></footer></div><script src="../../assets/js/main.min.js"></script> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-57751247-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> <script type="text/javascript"> /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */ var disqus_shortname = 'joklasite'; /* * * DON'T EDIT BELOW THIS LINE * * */ (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); /* * * DON'T EDIT BELOW THIS LINE * * */ (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></body></html>
